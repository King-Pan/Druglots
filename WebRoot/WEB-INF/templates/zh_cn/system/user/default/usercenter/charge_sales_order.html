<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>赊销账期及额度 - Powered by Druglots</title>
<meta name="keywords" content="$!config.keywords" />
<meta name="description" content="$!config.description" />
<meta name="generator" content="wemall 2.0" />
<meta name="author" content="www.wemall.com">
	<meta name="copyright" content="wemall Inc. All Rights Reserved">
		<link
			href="$!webPath/resources/style/system/front/default/css/public.css"
			type="text/css" rel="stylesheet" />
		<link
			href="$!webPath/resources/style/system/front/default/css/user.css"
			type="text/css" rel="stylesheet" />
		<link href="$!webPath/resources/js/theme/default/laydate.css"
			type="text/css" rel="stylesheet" />
		<script src="$!webPath/resources/js/laydate.js"></script>
		<script src="$!webPath/resources/js/jquery-1.8.3.min.js"></script>
		<script src="$!webPath/resources/js/jquery.shop.common.js"></script>
		
</head>
<style>
#test1, #test2, #test3, #test4, #test5 {
	width: 190px;
}

/* // 赊销订单 */
.order_tab_nav {
	margin: 24px 0 36px 20px;
}

.order_tab_nav li.this {
	background-color: #09F;
	color: #fff;
}

.order_tab_nav  li {
	float: left;
	padding: 8px 32px;
	border-radius: 20px;
	margin-right: 18px;
	border: 1px #ccc solid;
}

#js-box {
	display: none;
}

#orderTab li:hover {
	cursor: pointer;
}

#isBank p {
	text-align: center;
	font-size: 18px;
}

#sub-box {
	text-align: center;
}

#sub-box button:hover {
	cursor: pointer;
}
</style>

<script>
	$(function() {
		function number() {
			var page = $("#currentPage").val();
			if (page == 1) {
				for (var i = 0; i < $(".numberClass").length; i++) {
					$(".numberClass").get(i).innerHTML = i + 1;
				}

			} else {
				for (var i = 0; i < $(".numberClass").length; i++) {
					$(".numberClass").get(i).innerHTML = i + (page - 1) * 12
							+ 1;
				}
			}

		}
		number();
	});
</script>
<body>
	$!httpInclude.include("/top.htm")
	<div class="main">
		$!httpInclude.include("/seller/nav_head.htm")
		<div class="user_center">
			<table width="1200" border="0" cellspacing="0" cellpadding="0"
				class="user_table">
				<tr>
					$!httpInclude.include("/seller/nav.htm?op=quota_Management")
					<td id="centerbg" valign="top">
						<div class="buyer_position">
							<div class="buyer_p_box">
								<a href="$!webPath/seller/index.htm">卖家中心</a> > <span>赊销管理</span>
								> <span>我的赊销</span>
							</div>
						</div>
						<div class="productmain">
							<div class="ordernav">
								<ul class="orderul">
									#if($!storstatus == 0)
									<li><a href="$!webPath/seller/is_charge_sales.htm">开通赊销</a></li>
									#end
									<li><a href="$!webPath/seller/charge_sales_wallet.htm">赊销钱包</a></li>
									<li><a href="$!webPath/seller/my_charge_sales.htm">我的赊销</a></li>
									<li><a href="$!webPath/seller/charge_sales_check.htm">赊销审核</a></li>
									<li><a
										href="$!webPath/seller/addUpdate_customerCredit.htm?type=save">赊销授额</a></li>
									<li class="this" id="ssdd"><a
										href="$!webPath/seller/charge_sales_order.htm?twoStatus=1">赊销订单</a></li>
								</ul>
							</div>
							<div class="ordercon">
								<ul class="order_tab_nav clearfix" id="orderTab">
									<li class="this" value="0">对账订单</li>
									<li value="1">结算订单</li>
								</ul>
								<div>
									<!-- 对账订单开始 -->
									<div class="addnav" id="dz-box">
										<form method="post"
											action="$!webPath/seller/charge_sales_order.htm?twoStatus=1">
											<div class="seInput seInput2 seInput3 totalPart clearfix">
												<div class="everyPart">
													<div class="leftPart">客户名称：</div>
													<div class="rightPart">
														<input type="text" name="enterpriseName">
													</div>
												</div>
												<div class="everyPart">
													<div class="leftPart">客户编码：</div>
													<div class="rightPart">
														<input type="text" name="buyerId" disabled="disabled">
													</div>
												</div>
												<div class="everyPart">
													<div class="leftPart">交易日期：</div>
													<div class="rightPart">
														<input type="text" id="test1" name="payTime">
													</div>
												</div>
												<div class="everyPart">
													<div class="leftPart">订单编号：</div>
													<div class="rightPart">
														<input type="text" name="order_id">
													</div>
												</div>
												<div class="everyPart">
													<div class="leftPart">对账状态：</div>
													<div class="rightPart">
														<select name="bill_state" id="buyerId"
															style="height: 26px; font-size: 14px;">
															<option value="2">全部</option>
															<option value="1">已对账</option>
															<option value="0">未对账</option>
														</select>
													</div>
												</div>
												<div class="everyPart">
													<div class="leftPart">完成日期：</div>
													<div class="rightPart">
														<input type="text" id="test2" name="finishTime">
													</div>
												</div>
											</div>
											<div class="btn-box">
												<input class="apply-button"
													style='background-color: #09F; border: 1px solid #09F;'
													type="submit" value="查询" />
												<button class="apply-button"
													style='background-color: #fff; border: 1px solid #999; color: #666'
													type="reset" value="重置">重置</button>
											</div>
										</form>
										<div id="bigbox">
											<input class="apply-button"
												style='background-color: #09F; border: 1px solid #09F;'
												type="button" value="对账" onclick="openTc()" /> <input
												class="apply-button"
												style='background-color: #09F; border: 1px solid #09F;'
												type="button" value="导出" onclick="importOrderExecl()" />
											<div id="tablebox">
												<form action="" method="post" name="ListForm" id="ListForm">
													<table width="150%" border="0" cellspacing="0"
														cellpadding="0">
														<tr style="background-color: #2A7AD2; height: 30px;"
															class="yyyy">
															<td style="color: white;"><input type="checkbox"
																name="" id="allSelect" value="全选" /></td>
															<td style="color: white;">客户名称</td>
															<td style="color: white;">客户编码</td>
															<td style="color: white;">订单编号</td>
															<td style="color: white;">交易日期</td>
															<td style="color: white;">完成日期</td>
															<td style="color: white;">应结金额（元）</td>
															<td style="color: white;">配送费（元）</td>
															<td style="color: white;">对账状态</td>
															<td style="color: white;">操作</td>
														</tr>
														#foreach($objs in $objs) #if($!objs.authString)
														<tr class="zzzz">
															<td><input type="checkbox" name=""
																class="selectLine" value="$!objs.id" /></td>
															<td>$!objs.authString</td>
															<td></td>
															<td>$!objs.order_id</td>
															<td>$!date.format('yyyy-MM-dd',$!objs.payTime)</td>
															<td>$!date.format('yyyy-MM-dd',$!objs.finishTime)</td>
															<td>$!objs.totalPrice</td>
															<td>$!objs.ship_price</td> #if($!objs.bill_state == 0)
															<td>未对账</td> #else
															<td>已对账</td> #end
															<td>#if($!objs.bill_state == 0) <input
																class="apply-button" type="button" value="确认对账"
																onclick="openTc('$!objs.id')" /> #else -- #end
															</td>
														</tr>
														#end #end
													</table>
													<input id="currentPage" name="currentPage" type="hidden"
														value="$!currentPage" /> <input id="type" name="type"
														type="hidden" value="$!type" />
													<div class="alldel">
														<div class="userfenye">$!gotoPageFormHTML</div>
													</div>
												</form>
											</div>
										</div>
									</div>
									<!-- 对账订单结束 -->
									<!-- 结算订单开始 -->
									<div class="addnav" id="js-box">
										<form method="post"
											action="$!webPath/seller/charge_sales_order.htm?twoStatus=2">
											<div
												class="seInput seInput2 seInput3 totalPart  totalPart1 clearfix">
												<div class="everyPart">
													<div class="leftPart">客户名称：</div>
													<div class="rightPart">
														<input type="text" name="enterpriseName">
													</div>
												</div>
												<div class="everyPart">
													<div class="leftPart">客户编码：</div>
													<div class="rightPart">
														<input type="text" name="buyerId" disabled="disabled">
													</div>
												</div>
												<div class="everyPart">
													<div class="leftPart">交易日期：</div>
													<div class="rightPart">
														<input type="text" id="test3" name="payTime">
													</div>
												</div>
												<div class="everyPart">
													<div class="leftPart">订单编号：</div>
													<div class="rightPart">
														<input type="text" name="order_id">
													</div>
												</div>
												<div class="everyPart">
													<div class="leftPart">结算状态：</div>
													<div class="rightPart">
														<select name="settlement_status" id="buyerId"
															style="height: 26px; font-size: 14px;">
															<option value="0">全部</option>
															<option value="1">未结算</option>
															<option value="2">结算中</option>
															<option value="3">已结算</option>
														</select>
													</div>
												</div>
												<!--   <div class="everyPart">
                                                <div class="leftPart">预计回款日期：</div>
                                                <div class="rightPart">
                                                    <input type="text" id="test4" name = "repaymentDate">
                                                </div>
                                            </div> -->
												<div class="everyPart">
													<div class="leftPart">实际回款日期：</div>
													<div class="rightPart">
														<input type="text" name="actual_date" id="test4">
													</div>
												</div>
											</div>
											<div class="btn-box">
												<input class="apply-button"
													style='background-color: #09F; border: 1px solid #09F;'
													type="submit" value="查询" />
												<button class="apply-button"
													style='background-color: #fff; border: 1px solid #999; color: #666'
													type="reset" value="重置">重置</button>
											</div>
										</form>
										<div id="bigbox">
											<input class="apply-button"
												style='background-color: #09F; border: 1px solid #09F;'
												type="button" value="导出" onclick="exportCloseAccount()" />
											<div id="tablebox">
												<table width="150%" border="0" cellspacing="0"
													cellpadding="0">
													<tr style="background-color: #2A7AD2; height: 30px;"
														class="yyyy">
														<td style="color: white;">序号</td>
														<td style="color: white;">客户名称</td>
														<td style="color: white;">客户编码</td>
														<td style="color: white;">订单编号</td>
														<td style="color: white;">应结金额（元）</td>
														<td style="color: white;">交易日期</td>
														<td style="color: white;">预计回款日期</td>
														<td style="color: white;">实际回款日期</td>
														<td style="color: white;">逾期时长（天）</td>
														<td style="color: white;">逾期计息（%）</td>
														<td style="color: white;">总罚息（元）</td>
														<td style="color: white;">支付方式</td>
														<td style="color: white;">银行流水单号</td>
														<td style="color: white;">每月回款编号</td>
														<td style="color: white;">状态</td>
													</tr>
													#foreach($objs in $objs)
													<tr class="zzzz">
													    <td class="numberClass"></td>
														#if($!objs.authString)
														<td>$!objs.authString</td>
														<td></td>
														<td>$!objs.order_id</td>
														<td id="backdue$!objs.id"></td>
														<td>$!date.format('yyyy-MM-dd',$!objs.payTime)</td>
														<td>$!objs.repaymentDate</td> #if($!objs.actual_date)
														<td>$!objs.actual_date</td> #else
														<td>--</td> #end
														<td>$!objs.days</td>
														<td>$!objs.interest</td>
														<td id="overdue$!objs.id">总罚息（元）</td>
														#if($!objs.payment.mark=="shexiao") #set($payment="赊销支付")
														#end
														<td>$!payment</td>
														<!-- 状态为已结算的订单，展示银行流水单号，未结算以及结算中的，不展示 -->
														#if($!objs.settlement_status == 1 ||
														$!objs.settlement_status == 2)
														<td>--</td> #else
														<td>银行流水单号</td> #end

														<td>$!objs.number</td> #if($!objs.settlement_status == 1)
														<td>未结算</td> #end #if($!objs.settlement_status == 2)
														<td>结算中</td> #end #if($!objs.settlement_status == 3)
														<td>已结算</td> #end
														<script>
                                                    function numMulti(num1, num2,num3) {
                                                        var baseNum = 0;
                                                        try {
                                                            baseNum += num1.toString().split(".")[1].length;
                                                        } catch (e) {
                                                        }
                                                        try {
                                                            baseNum += num2.toString().split(".")[1].length;
                                                        } catch (e) {
                                                        }
                                                        try {
                                                            baseNum += num3.toString().split(".")[1].length;
                                                        } catch (e) {
                                                        }
                                                        return Number(num1.toString().replace(".", ""))
                                                                * Number(num2.toString().replace(".", ""))
                                                                * Number(num3.toString().replace(".", ""))
                                                                / Math.pow(10, baseNum);
                                                    };
                                                    var value = numMulti($!objs.totalPrice,$!objs.interest,$!objs.days)
                                                    jQuery("#overdue$!objs.id").text(value);
                                                    jQuery("#backdue$!objs.id").text(value+$!objs.totalPrice);
                                                     </script>
														#end
													</tr>
													#end
												</table>
											</div>
											<input id="currentPage" name="currentPage" type="hidden"
												value="$!currentPage" /> <input id="type" name="type"
												type="hidden" value="$!type" />
											<div class="alldel">
												<div class="userfenye">$!gotoPageFormHTML</div>
											</div>
										</div>
									</div>
									<!-- 结算订单结束 -->
								</div>
							</div>
						</div>
					</td>
				</tr>
			</table>
		</div>
		$!httpInclude.include("/footer.htm")
	</div>
	<!-- 弹窗对账 -->
	<div id="tc-box" style="top: 250px">
		<h1 onclick="closeTc()">x</h1>
		<div id="isBank">
			<div class="seInput seInput2 clearfix">
				<p>是否确定对账!</p>
			</div>
			<div id="sub-box">
				<button class="bank-sub bdrBtn" onclick="closeTc()">取消</button>
				<button class="bank-sub bgcBtn" onclick="isSend()">确定</button>
			</div>
		</div>
	</div>
</body>
<script>
//执行一个laydate实例
laydate.render({
    elem: '#test1' //指定元素
        ,
    range: true
});
//执行一个laydate实例
laydate.render({
    elem: '#test2' //指定元素
        ,
    range: true
});

//执行一个laydate实例
laydate.render({
    elem: '#test3' //指定元素
        ,
    range: true
});

//执行一个laydate实例
laydate.render({
    elem: '#test4' //指定元素
        ,
    range: true
});

//执行一个laydate实例
laydate.render({
    elem: '#test5' //指定元素
        ,
    range: true
});

jQuery("#ssdd").click(function() {
    localStorage.removeItem('Ordervalue')
    jQuery("#orderTab li").removeClass('this')
    jQuery("#dz-box").show().siblings().hide();

})

jQuery(document).ready(function($) {

    var index = localStorage.getItem("Ordervalue")
  	if(index == 1 ){
  		jQuery("#js-box").show().siblings().hide();
  		jQuery("#orderTab li").eq(1).addClass('this').siblings().removeClass('this')
  	} else if(index == 0){
  		jQuery("#dz-box").show().siblings().hide();
  		jQuery("#orderTab li").eq(0).addClass('this').siblings().removeClass('this')
  	} 
})

jQuery("#orderTab").click(function(event) {

    if (event.target.nodeName == "LI") {
        jQuery(event.target).addClass('this')
        jQuery(event.target).siblings("li").removeClass('this')
        if (event.target.getAttribute("value") == "1") {
        	localStorage.setItem("Ordervalue", "1")
        	/* 结算订单 */
        	window.location.href = '$!webPath/seller/charge_sales_order.htm?twoStatus=2'
            jQuery("#js-box").show();
            jQuery("#dz-box").hide();
        } else if (event.target.getAttribute("value") == "0") {
        	localStorage.setItem("Ordervalue", "0")
        	/* 对账 */
        	window.location.href = '$!webPath/seller/charge_sales_order.htm?twoStatus=1'
            jQuery("#js-box").hide();
            jQuery("#dz-box").show();
        }

    }
});

function closeTc() {
    jQuery("#tc-box").hide();
    jQuery("#isBank").hide();
}

var orderIds = "";

function openTc(id) {
    orderIds = "";
    if (id) {
        orderIds = id;
    } else {
        var flagS = false;
        $(".selectLine").each(function(index, item) {
            //由于复选框一般选中的是多个,所以可以循环输出
            if ($(item).prop("checked")) {
                flagS = true;
            }
        });
        if (!flagS) {
            alert("请选择对账订单");
            return false;
        }
    }
    jQuery("#tc-box").show();
    jQuery("#isBank").show();
}

function importOrderExecl() {
    window.location.href = "$!webPath/seller/orderExport.htm"
}

function exportCloseAccount() {
    window.location.href = "$!webPath/seller/exportCloseAccount.htm"
}

$("#allSelect").click(function() {

    $(".selectLine").attr("checked", $(this).prop("checked"));


})

jQuery(".selectLine").click(function(event) {
    /* Act on the event */
    var flag = true;
    $(".selectLine").each(function(index, item) {
        //由于复选框一般选中的是多个,所以可以循环输出
        if (!$(item).prop("checked")) {
            flag = false;
        }
    });
    if (flag) {
        $("#allSelect").prop("checked", true)
    } else {
        $("#allSelect").prop("checked", false)
    }
});

function isSend() {
    if (orderIds == "") {
        $(".selectLine:checked").each(function() {
            //由于复选框一般选中的是多个,所以可以循环输出
            orderIds += ',' + $(this).val()
        });
        orderIds = orderIds.replace(/^,/, "")
    }
    closeTc();
    if (orderIds.length != 0) {
        jQuery.ajax({
                url: '$!webPath/seller/bill_sales.htm',
                type: 'post',
                data: { orderIds: orderIds },
            })
            .done(function(res) {
                window.location.reload();
            })

    }


}
</script>

</html>